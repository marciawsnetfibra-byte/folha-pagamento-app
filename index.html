<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Adicionais e Reflexos da Folha de Pagamento</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- SheetJS para importa√ß√£o de planilhas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- jsPDF para gera√ß√£o de PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root {
            --cor-titulo: #1800AD;
            --cor-menu: #1800AD;
            --cor-menu-hover: #0d0066;
            --cor-importar: #10B981;
            --cor-importar-hover: #059669;
        }
        .titulo-cor { color: var(--cor-titulo) !important; }
        .main-menu {
            background-color: var(--cor-menu);
            padding: 0.75rem 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .menu-container {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .menu-logo {
            color: white;
            font-weight: bold;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
        }
        .menu-logo i { margin-right: 8px; }
        .menu-items { display: flex; gap: 1rem; }
        .menu-button {
            background-color: transparent;
            color: white;
            border: 1px solid transparent;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .menu-button:hover {
            background-color: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.3);
        }
        .menu-button.active {
            background-color: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.5);
        }
        .btn-importar {
            background-color: var(--cor-importar);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-importar:hover {
            background-color: var(--cor-importar-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(16,185,129,0.2);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f9fafb;
            border-radius: 10px 10px 0 0;
        }
        .modal-title {
            font-weight: 600;
            color: var(--cor-titulo);
            font-size: 1.25rem;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }
        .modal-close:hover { color: #374151; }
        .modal-body { padding: 1.5rem; }
        .container {
            max-width: 1100px;
            margin: 40px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        input[type="text"], input[type="number"], select, input[type="month"], input[type="date"], input[type="file"] {
            border: 1px solid #ccc;
            padding: 8px;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
            height: 40px !important;
            line-height: normal;
        }
        .collaborator-table, .department-table, .history-table, .import-preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .collaborator-table th, .department-table th, .history-table th, .import-preview-table th {
            background-color: #f3f4f6;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }
        .collaborator-table td, .department-table td, .history-table td, .import-preview-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .import-preview-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin: 1rem 0;
        }
        .status-toggle-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background-color: #f3f4f6;
            border-radius: 8px;
        }
        .status-toggle-btn {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .status-toggle-btn.active {
            background-color: var(--cor-titulo);
            color: white;
            border-color: var(--cor-titulo);
        }
        .status-toggle-btn:not(.active) {
            background-color: white;
            color: var(--cor-titulo);
            border-color: #d1d5db;
        }
        .status-toggle-btn:not(.active):hover { background-color: #f0f4ff; }
        .info-box {
            background-color: #e0f2fe;
            border-left: 4px solid #0369a1;
            padding: 12px 16px;
            margin: 16px 0;
            border-radius: 4px;
        }
        .firebase-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .firebase-connected { background-color: #10B981; color: white; }
        .firebase-disconnected { background-color: #EF4444; color: white; }
        .firebase-loading { background-color: #F59E0B; color: white; }
        .firebase-offline { background-color: #6B7280; color: white; }
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        .login-box {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .login-tabs {
            display: flex;
            gap: 1px;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            overflow: hidden;
            background-color: #e5e7eb;
        }
        .login-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background-color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }
        .login-tab.active {
            background-color: var(--cor-titulo);
            color: white;
        }
        .sync-badge {
            background-color: #3B82F6;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-left: 5px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 14px;
            margin-left: 20px;
        }
        .login-error {
            display: none;
            background-color: #FEE2E2;
            border: 1px solid #FECACA;
            color: #DC2626;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        .login-error.show { display: block; }
        .success-message {
            background-color: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .warning-message {
            background-color: #fffbeb;
            border: 1px solid #fcd34d;
            color: #92400e;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .import-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        .stat-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: var(--cor-titulo);
        }
        .stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background-color: #f9fafb;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .file-upload-area:hover {
            border-color: var(--cor-importar);
            background-color: #f0fdf4;
        }
        .file-upload-area i {
            font-size: 48px;
            color: var(--cor-importar);
            margin-bottom: 12px;
        }
        .moeda-br {
            color: var(--cor-titulo);
            font-weight: 600;
        }
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 14px;
        }
        .report-table th {
            background-color: var(--cor-titulo);
            color: white;
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .report-table td {
            padding: 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        .report-table tr:hover { background-color: #f0f4ff; }
        .report-table tr.total-row {
            background-color: #e0f2fe;
            font-weight: bold;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        .filter-badge {
            display: inline-flex;
            align-items: center;
            background-color: #e0f2fe;
            color: #0369a1;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .column-toggle-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .column-toggle-btn.active {
            background-color: var(--cor-titulo);
            color: white;
            border-color: var(--cor-titulo);
        }
    </style>
</head>
<body class="bg-gray-100 p-4">

    <!-- Status do Firebase -->
    <div id="firebaseStatus" class="firebase-status firebase-loading">
        <i class="fas fa-sync fa-spin"></i>
        <span>Conectando ao banco de dados...</span>
    </div>

    <!-- MODAL DE LOGIN CORRIGIDO -->
    <div id="loginModal" class="login-modal" style="display: flex;">
        <div class="login-box">
            <div class="text-center mb-6">
                <i class="fas fa-calculator text-5xl titulo-cor mb-4"></i>
                <h2 class="text-2xl font-bold titulo-cor">Folha de Pagamento</h2>
                <p class="text-gray-600 mt-2">Fa√ßa login para acessar o sistema</p>
            </div>
            
            <div class="login-tabs">
                <button class="login-tab active" id="tabLogin">Entrar</button>
                <button class="login-tab" id="tabSignup">Criar Conta</button>
            </div>
            
            <div id="loginError" class="login-error">
                <i class="fas fa-exclamation-circle mr-1"></i>
                <span id="errorText">Erro ao processar</span>
            </div>
            
            <!-- FORMUL√ÅRIO DE LOGIN -->
            <div id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-3 text-gray-400"></i>
                            <input type="email" id="loginEmail" class="w-full pl-10 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   placeholder="seu@email.com" autocomplete="username">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                            <input type="password" id="loginPassword" class="w-full pl-10 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
                        </div>
                    </div>
                    <button id="btnLogin" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 font-medium transition duration-150">
                        <i class="fas fa-sign-in-alt mr-2"></i>Entrar
                    </button>
                </div>
            </div>
            
            <!-- FORMUL√ÅRIO DE CADASTRO CORRIGIDO -->
            <div id="signupForm" style="display: none;">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-3 text-gray-400"></i>
                            <input type="email" id="signupEmail" class="w-full pl-10 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   placeholder="seu@email.com" autocomplete="username">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Senha (m√≠nimo 6 caracteres)</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                            <input type="password" id="signupPassword" class="w-full pl-10 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Confirmar Senha</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-3 text-gray-400"></i>
                            <input type="password" id="signupConfirmPassword" class="w-full pl-10 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
                        </div>
                    </div>
                    <button id="btnSignup" class="w-full bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 font-medium transition duration-150">
                        <i class="fas fa-user-plus mr-2"></i>Criar Conta
                    </button>
                </div>
            </div>
            
            <div class="mt-6 pt-6 border-t text-center">
                <button id="btnContinueOffline" class="text-blue-600 hover:text-blue-800 text-sm">
                    <i class="fas fa-laptop mr-1"></i>Continuar sem login
                </button>
            </div>
        </div>
    </div>

    <!-- MENU HORIZONTAL -->
    <nav class="main-menu print-hide">
        <div class="menu-container">
            <div class="menu-logo">
                <i class="fas fa-calculator"></i>
                <span>Folha de Pagamento</span>
                <div id="userInfo" class="user-info" style="display: none;">
                    <i class="fas fa-user-circle"></i>
                    <span id="userEmail"></span>
                </div>
            </div>
            <div class="menu-items">
                <button class="menu-button active" id="menuCalculator">
                    <i class="fas fa-calculator"></i> Calculadora
                </button>
                <button class="menu-button" id="menuCollaborators">
                    <i class="fas fa-users"></i> Colaboradores
                </button>
                <button class="menu-button" id="menuHistory">
                    <i class="fas fa-history"></i> Hist√≥rico
                </button>
                <button class="menu-button" id="menuReports">
                    <i class="fas fa-chart-bar"></i> Relat√≥rios
                </button>
                <button class="menu-button" id="btnLogout" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </div>
    </nav>

    <!-- CONTE√öDO PRINCIPAL (CALCULADORA) -->
    <div class="container" id="calculatorContent">
        <h1 class="text-3xl font-bold titulo-cor text-center mb-6 border-b pb-2">
            Calculadora de Adicionais e Reflexos da Folha de Pagamento
        </h1>
        
        <!-- Seletor de Colaborador -->
        <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="font-bold text-lg titulo-cor mb-2">Selecionar Colaborador</h3>
                    <p class="text-sm text-gray-600">Escolha um colaborador cadastrado para preencher os dados automaticamente</p>
                </div>
                <button id="refreshCollaborators" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-sync-alt"></i> Atualizar
                </button>
            </div>
            <div class="mt-3">
                <select id="collaboratorSelect" class="w-full">
                    <option value="">-- Selecione um colaborador --</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Coluna de Entradas -->
            <div id="input-container">
                <h2 class="text-xl font-semibold mb-4 titulo-cor">Entradas de Dados</h2>
                <div class="space-y-4 mb-6 p-4 bg-gray-50 rounded-lg border">
                    <h3 class="font-bold text-lg border-b pb-2 titulo-cor">Sal√°rio e Divisor</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Sal√°rio Base (R$)</label>
                            <input type="text" id="salarioBase" value="" class="mt-1" placeholder="Ex: R$ 1.518,00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Horas Mensais</label>
                            <select id="divisorMensal" class="mt-1">
                                <option value="220" selected>220 (Padr√£o)</option>
                                <option value="180">180 horas</option>
                                <option value="170">170 (Reduzido)</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex items-center mt-4 pt-2 border-t">
                        <input type="checkbox" id="usaPericulosidade" checked class="h-4 w-4 text-indigo-600 border-gray-300 rounded mr-2">
                        <label class="text-sm font-medium text-gray-700">Incluir Adicional de Periculosidade (30%)</label>
                        <span id="valorPericulosidadeInputDisplay" class="ml-auto font-bold titulo-cor">R$ 0,00</span>
                    </div>
                </div>
                
                <div class="space-y-4 mb-6 p-4 bg-gray-50 rounded-lg border">
                    <h3 class="font-bold text-lg border-b pb-2 titulo-cor">Horas de Adicionais</h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Horas de Sobreaviso</label>
                            <input type="text" id="horasSobreavisoTotal" value="00:00" placeholder="HH:MM" class="mt-1 text-center">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Horas de Sobreaviso Trabalhado</label>
                            <input type="text" id="horasTrabalhadas50" value="00:00" placeholder="HH:MM" class="mt-1 text-center">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Horas Extras 50%</label>
                            <input type="text" id="horasTrabalhadas100" value="00:00" placeholder="HH:MM" class="mt-1 text-center">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Horas Adicional Noturno</label>
                            <input type="text" id="horasNoturnas" value="00:00" placeholder="HH:MM" class="mt-1 text-center">
                        </div>
                    </div>
                </div>

                <div class="space-y-4 mb-6 p-4 bg-green-50 rounded-lg border">
                    <h3 class="font-bold text-lg border-b pb-2 titulo-cor">Informa√ß√µes de Pagamento</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="pagoFolha" class="h-4 w-4 text-green-600 border-gray-300 rounded mr-2">
                            <label class="text-sm font-medium text-gray-700">Pago em Folha?</label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Compet√™ncia</label>
                            <input type="month" id="competenciaPagamento" class="mt-1">
                        </div>
                    </div>
                </div>

                <div class="space-y-4 p-4 bg-gray-50 rounded-lg border">
                    <h3 class="font-bold text-lg border-b pb-2 titulo-cor">Fator DSR, Dias e Aus√™ncias</h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">M√™s Ref.</label>
                            <input type="month" id="mesReferencia" class="mt-1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Dias Normais</label>
                            <input type="number" id="diasTrabalhados" min="1" max="30" value="30" class="mt-1 text-center">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Dias Atestado</label>
                            <input type="number" id="diasAtestado" value="0" min="0" class="mt-1 text-center">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Feriados</label>
                            <input type="number" id="diasFeriado" value="0" min="0" class="mt-1 text-center">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coluna de Resultados -->
            <div>
                <h2 class="text-xl font-semibold mb-4 titulo-cor">Resultados e Bases</h2>
                <div class="space-y-4 p-4 bg-indigo-50 rounded-lg border border-indigo-200 mb-6">
                    <h3 class="font-bold text-lg border-b pb-2 titulo-cor">Adicionais e Periculosidade</h3>
                    <div id="periculosidadeDetalhada" class="text-xs text-gray-600 mb-2" style="display: none;"></div>
                    <div class="flex justify-between text-base font-semibold">
                        <span>Periculosidade (30%)</span>
                        <span id="valorPericulosidade" class="titulo-cor">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Horas de Sobreaviso:</span>
                        <span id="valorSobreavisoEspera" class="titulo-cor">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Sob. Trabalhado (50%):</span>
                        <span id="valorHoraExtraTrabalho50" class="titulo-cor">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Horas Extras 50%:</span>
                        <span id="valorHoraExtraTrabalho100" class="titulo-cor">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Adicional Noturno:</span>
                        <span id="valorAdicionalNoturno" class="titulo-cor">R$ 0,00</span>
                    </div>
                </div>

                <div class="space-y-4 p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                    <h3 class="font-bold text-lg border-b pb-2 titulo-cor">Reflexos DSR (Fator: <span id="fatorDSRDisplay">0.0000</span>)</h3>
                    <div class="flex justify-between text-sm">
                        <span>Reflexo Sobreaviso:</span>
                        <span id="valorReflexoSobreavisoEspera" class="text-indigo-700 font-semibold">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Reflexo Sob. Trabalhado:</span>
                        <span id="valorReflexoSobreavisoTrabalhado" class="text-indigo-700 font-semibold">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Reflexo Horas Extras:</span>
                        <span id="valorReflexoHorasExtrasNormal" class="text-indigo-700 font-semibold">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Reflexo Ad. Noturno:</span>
                        <span id="valorReflexoAdicionalNoturno" class="text-indigo-700 font-semibold">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between text-lg font-bold pt-2 border-t border-indigo-300">
                        <span>TOTAL REFLEXOS:</span>
                        <span id="valorReflexoDSRTotalSum" class="titulo-cor">R$ 0,00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOT√ïES DE A√á√ÉO -->
        <div class="flex flex-wrap justify-end gap-4 mt-12 print-hide border-t pt-6">
            <button id="saveCalculation" class="bg-blue-100 hover:bg-blue-200 text-blue-800 font-semibold py-2 px-4 rounded-lg">
                <i class="fas fa-save mr-1"></i> Salvar C√°lculo
            </button>
            <button id="clearButton" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg">
                <i class="fas fa-eraser mr-1"></i> Limpar
            </button>
            <button id="printButton" class="text-sm font-semibold py-2 px-4 rounded-lg">
                <i class="fas fa-print mr-1"></i> Salvar em PDF
            </button>
        </div>
    </div>

    <!-- CONTE√öDO DE COLABORADORES -->
    <div class="container hidden" id="collaboratorsContent">
        <h1 class="text-3xl font-bold titulo-cor text-center mb-6 border-b pb-2">
            <i class="fas fa-users mr-2"></i> Gerenciar Colaboradores
        </h1>
        
        <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <div class="flex flex-wrap justify-between items-center gap-4">
                <div class="flex flex-wrap gap-2">
                    <button id="addNewCollaborator" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center">
                        <i class="fas fa-user-plus mr-2"></i> Novo Colaborador
                    </button>
                    <button id="importCollaboratorsBtn" class="btn-importar">
                        <i class="fas fa-file-import mr-2"></i> Importar Planilha
                    </button>
                </div>
                <button id="refreshCollaboratorList" class="text-blue-600 hover:text-blue-800 px-3 py-1">
                    <i class="fas fa-sync-alt mr-1"></i> Atualizar
                </button>
            </div>
        </div>
        
        <div class="status-toggle-buttons">
            <button class="status-toggle-btn active" id="showActiveCollaborators">
                <i class="fas fa-user-check mr-1"></i> Ativos
            </button>
            <button class="status-toggle-btn" id="showInactiveCollaborators">
                <i class="fas fa-user-slash mr-1"></i> Inativos
            </button>
        </div>
        
        <div id="collaboratorsTableContainer"></div>
    </div>

    <!-- MODAL DE IMPORTA√á√ÉO -->
    <div class="modal" id="importSpreadsheetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-excel mr-2 text-green-600"></i>
                    Importar Colaboradores
                </h3>
                <button class="modal-close" id="closeImportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="importMessages"></div>
                
                <div class="info-box">
                    <strong><i class="fas fa-info-circle mr-2"></i>Formato da Planilha:</strong>
                    <p class="mt-2 text-sm">Colunas: Nome, Departamento, Sal√°rio, Periculosidade, Horas Mensais</p>
                    <p class="mt-2 text-xs text-gray-600">
                        <a href="#" id="downloadTemplate" class="text-blue-600 hover:underline">
                            <i class="fas fa-download mr-1"></i> Baixar modelo
                        </a>
                    </p>
                </div>

                <div class="file-upload-area" id="fileUploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4 class="text-lg font-semibold text-gray-700 mb-2">
                        Clique para selecionar ou arraste o arquivo
                    </h4>
                    <p class="text-sm text-gray-500 mb-4">.xlsx, .xls, .csv</p>
                    <input type="file" id="spreadsheetFile" accept=".xlsx,.xls,.csv" class="hidden">
                    <button id="selectFileButton" class="btn-importar mx-auto">
                        <i class="fas fa-file-excel mr-2"></i> Selecionar Arquivo
                    </button>
                </div>

                <div id="importPreview" style="display: none;">
                    <h4 class="font-bold text-lg titulo-cor mt-6 mb-3">
                        <i class="fas fa-eye mr-2"></i> Pr√©via dos Dados
                    </h4>
                    <div id="importStats" class="import-stats"></div>
                    <div class="import-preview-container">
                        <table class="import-preview-table">
                            <thead id="previewTableHeader"></thead>
                            <tbody id="previewTableBody"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
                        <button type="button" id="cancelImport" class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button type="button" id="confirmImport" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                            <i class="fas fa-check-circle mr-2"></i> Confirmar Importa√ß√£o
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ÉO DO FIREBASE - VIA VARI√ÅVEIS DE AMBIENTE
        // ============================================
        
        // IMPORTANTE: Na Vercel, estas vari√°veis devem ser configuradas!
        const firebaseConfig = {
            apiKey: typeof process !== 'undefined' && process.env.NEXT_PUBLIC_FIREBASE_API_KEY 
                ? process.env.NEXT_PUBLIC_FIREBASE_API_KEY 
                : "AIzaSyDUyddWZtEOMYsP2ZoaeJLU2OdgV9E1l94",
            authDomain: typeof process !== 'undefined' && process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN 
                ? process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN 
                : "calculadora-folha-pagamento.firebaseapp.com",
            projectId: typeof process !== 'undefined' && process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID 
                ? process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID 
                : "calculadora-folha-pagamento",
            storageBucket: typeof process !== 'undefined' && process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET 
                ? process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET 
                : "calculadora-folha-pagamento.firebasestorage.app",
            messagingSenderId: typeof process !== 'undefined' && process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID 
                ? process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID 
                : "286786547060",
            appId: typeof process !== 'undefined' && process.env.NEXT_PUBLIC_FIREBASE_APP_ID 
                ? process.env.NEXT_PUBLIC_FIREBASE_APP_ID 
                : "1:286786547060:web:74c68fef3dd79fc61a9021"
        };

        console.log("üöÄ Inicializando Firebase...");
        console.log("Config:", firebaseConfig);

        // Inicializar Firebase
        let db, auth;
        try {
            if (typeof firebase !== 'undefined') {
                if (firebase.apps.length === 0) {
                    firebase.initializeApp(firebaseConfig);
                    console.log("‚úÖ Firebase inicializado com sucesso!");
                } else {
                    console.log("‚úÖ Firebase j√° estava inicializado");
                }
                
                db = firebase.firestore();
                auth = firebase.auth();
                
                // Configurar persist√™ncia
                auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
                    .then(() => console.log("‚úÖ Persist√™ncia configurada"))
                    .catch(err => console.error("‚ùå Erro na persist√™ncia:", err));
            }
        } catch (error) {
            console.error("‚ùå Erro ao inicializar Firebase:", error);
        }

        // ============================================
        // VARI√ÅVEIS GLOBAIS
        // ============================================
        
        let currentUser = null;
        let userData = null;
        let importData = null;
        let currentCollaboratorStatus = 'active';
        
        const R$ = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
        const COLLABORATORS_STORAGE_KEY = 'folha_colaboradores_cadastrados';
        const CALCULATIONS_STORAGE_KEY = 'folha_calculos_salvos';
        const DEPARTMENTS_STORAGE_KEY = 'folha_departamentos';

        // ============================================
        // FUN√á√ÉO CORRIGIDA DE CADASTRO - ESSA √â A SOLU√á√ÉO!
        // ============================================
        
        document.getElementById('btnSignup').addEventListener('click', async function(e) {
            e.preventDefault();
            console.log("üìù Tentativa de cadastro...");
            
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const errorElement = document.getElementById('loginError');
            const errorText = document.getElementById('errorText');
            
            // Valida√ß√µes b√°sicas
            if (!email || !password || !confirmPassword) {
                errorText.textContent = 'Preencha todos os campos!';
                errorElement.classList.add('show');
                return;
            }
            
            if (password !== confirmPassword) {
                errorText.textContent = 'As senhas n√£o coincidem!';
                errorElement.classList.add('show');
                return;
            }
            
            if (password.length < 6) {
                errorText.textContent = 'A senha deve ter pelo menos 6 caracteres!';
                errorElement.classList.add('show');
                return;
            }
            
            // Valida√ß√£o de email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorText.textContent = 'Digite um email v√°lido!';
                errorElement.classList.add('show');
                return;
            }
            
            // Verificar se auth existe
            if (!auth) {
                errorText.textContent = 'Erro de conex√£o. Tente novamente.';
                errorElement.classList.add('show');
                return;
            }
            
            try {
                // 1. CRIAR USU√ÅRIO
                console.log("üìù Criando usu√°rio:", email);
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log("‚úÖ Usu√°rio criado com sucesso! UID:", user.uid);
                
                // 2. CRIAR DOCUMENTO NO FIRESTORE
                try {
                    if (db) {
                        await db.collection('users').doc(user.uid).set({
                            email: user.email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                            departments: [],
                            collaborators: [],
                            calculations: []
                        });
                        console.log("‚úÖ Documento do usu√°rio criado no Firestore");
                    }
                } catch (firestoreError) {
                    console.warn("‚ö†Ô∏è Erro ao criar documento, mas usu√°rio j√° existe:", firestoreError);
                }
                
                // 3. SUCESSO - LIMPAR E FECHAR
                errorElement.classList.remove('show');
                
                // Limpar campos
                document.getElementById('signupEmail').value = '';
                document.getElementById('signupPassword').value = '';
                document.getElementById('signupConfirmPassword').value = '';
                
                // Mostrar mensagem de sucesso
                updateFirebaseStatus('success', 'Conta criada! Bem-vindo!');
                
                // Fechar modal
                setTimeout(() => {
                    document.getElementById('loginModal').style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Erro no cadastro:', error);
                
                // Mensagens amig√°veis
                let message = '';
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        message = 'Este email j√° est√° cadastrado. Fa√ßa login!';
                        break;
                    case 'auth/invalid-email':
                        message = 'Email inv√°lido.';
                        break;
                    case 'auth/operation-not-allowed':
                        message = 'Cadastro desabilitado. Ative Email/Senha no Firebase!';
                        break;
                    case 'auth/weak-password':
                        message = 'Senha muito fraca. Use 6+ caracteres.';
                        break;
                    case 'auth/network-request-failed':
                        message = 'Erro de conex√£o. Verifique sua internet.';
                        break;
                    default:
                        message = `Erro: ${error.message}`;
                }
                
                errorText.textContent = message;
                errorElement.classList.add('show');
                updateFirebaseStatus('error', 'Erro no cadastro');
            }
        });

        // ============================================
        // FUN√á√ÉO DE LOGIN CORRIGIDA
        // ============================================
        
        document.getElementById('btnLogin').addEventListener('click', async function(e) {
            e.preventDefault();
            console.log("üîê Tentativa de login...");
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('loginError');
            const errorText = document.getElementById('errorText');
            
            if (!email || !password) {
                errorText.textContent = 'Preencha email e senha!';
                errorElement.classList.add('show');
                return;
            }
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log("‚úÖ Login bem sucedido:", userCredential.user.email);
                
                errorElement.classList.remove('show');
                updateFirebaseStatus('success', 'Login realizado!');
                
                setTimeout(() => {
                    document.getElementById('loginModal').style.display = 'none';
                }, 500);
                
            } catch (error) {
                console.error('‚ùå Erro no login:', error);
                
                let message = '';
                switch (error.code) {
                    case 'auth/user-not-found':
                        message = 'Usu√°rio n√£o encontrado. Crie uma conta!';
                        break;
                    case 'auth/wrong-password':
                        message = 'Senha incorreta!';
                        break;
                    case 'auth/invalid-email':
                        message = 'Email inv√°lido!';
                        break;
                    default:
                        message = `Erro: ${error.message}`;
                }
                
                errorText.textContent = message;
                errorElement.classList.add('show');
            }
        });

        // ============================================
        // OBSERVADOR DE AUTENTICA√á√ÉO
        // ============================================
        
        if (auth) {
            auth.onAuthStateChanged((user) => {
                console.log("üîÑ Estado de autentica√ß√£o mudou:", user ? user.email : "deslogado");
                
                if (user) {
                    currentUser = user;
                    document.getElementById('loginModal').style.display = 'none';
                    document.getElementById('userInfo').style.display = 'flex';
                    document.getElementById('userEmail').textContent = user.email;
                    document.getElementById('btnLogout').style.display = 'block';
                    
                    updateFirebaseStatus('success', `Logado como ${user.email}`);
                    loadUserData();
                } else {
                    currentUser = null;
                    document.getElementById('userInfo').style.display = 'none';
                    document.getElementById('btnLogout').style.display = 'none';
                    
                    // S√≥ mostra modal se n√£o estiver offline
                    if (!localStorage.getItem('skipLogin')) {
                        document.getElementById('loginModal').style.display = 'flex';
                    }
                    
                    updateFirebaseStatus('disconnected', 'Desconectado');
                }
            });
        }

        // ============================================
        // LOGOUT
        // ============================================
        
        document.getElementById('btnLogout').addEventListener('click', async function() {
            try {
                await auth.signOut();
                localStorage.removeItem('skipLogin');
                console.log("‚úÖ Logout realizado");
            } catch (error) {
                console.error("‚ùå Erro no logout:", error);
            }
        });

        // ============================================
        // CONTINUAR OFFLINE
        // ============================================
        
        document.getElementById('btnContinueOffline').addEventListener('click', function() {
            localStorage.setItem('skipLogin', 'true');
            document.getElementById('loginModal').style.display = 'none';
            updateFirebaseStatus('offline', 'Modo offline');
        });

        // ============================================
        // ATUALIZAR STATUS DO FIREBASE
        // ============================================
        
        function updateFirebaseStatus(type, message) {
            const statusEl = document.getElementById('firebaseStatus');
            if (!statusEl) return;
            
            statusEl.className = 'firebase-status';
            
            switch(type) {
                case 'success':
                    statusEl.classList.add('firebase-connected');
                    statusEl.innerHTML = `<i class="fas fa-check"></i> <span>${message}</span>`;
                    break;
                case 'error':
                    statusEl.classList.add('firebase-disconnected');
                    statusEl.innerHTML = `<i class="fas fa-exclamation-triangle"></i> <span>${message}</span>`;
                    break;
                case 'offline':
                    statusEl.classList.add('firebase-offline');
                    statusEl.innerHTML = `<i class="fas fa-laptop"></i> <span>${message}</span>`;
                    break;
                default:
                    statusEl.classList.add('firebase-loading');
                    statusEl.innerHTML = `<i class="fas fa-sync fa-spin"></i> <span>${message}</span>`;
            }
        }

        // ============================================
        // CARREGAR DADOS DO USU√ÅRIO
        // ============================================
        
        async function loadUserData() {
            if (!currentUser || !db) return;
            
            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                
                if (doc.exists) {
                    userData = doc.data();
                    console.log("‚úÖ Dados carregados do Firebase");
                    
                    // Sincronizar dados locais
                    if (userData.collaborators) {
                        localStorage.setItem(COLLABORATORS_STORAGE_KEY, JSON.stringify(userData.collaborators));
                    }
                    if (userData.departments) {
                        localStorage.setItem(DEPARTMENTS_STORAGE_KEY, JSON.stringify(userData.departments));
                    }
                    if (userData.calculations) {
                        localStorage.setItem(CALCULATIONS_STORAGE_KEY, JSON.stringify(userData.calculations));
                    }
                }
            } catch (error) {
                console.error("‚ùå Erro ao carregar dados:", error);
            }
        }

        // ============================================
        // FUN√á√ïES DE ARMAZENAMENTO LOCAL
        // ============================================
        
        function getCollaborators() {
            const data = localStorage.getItem(COLLABORATORS_STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }
        
        function saveCollaborators(collaborators) {
            localStorage.setItem(COLLABORATORS_STORAGE_KEY, JSON.stringify(collaborators));
            
            // Sincronizar com Firebase se estiver logado
            if (currentUser && db) {
                db.collection('users').doc(currentUser.uid).update({
                    collaborators: collaborators,
                    lastSync: firebase.firestore.FieldValue.serverTimestamp()
                }).catch(err => console.error("Erro ao sincronizar:", err));
            }
        }
        
        function getDepartments() {
            const data = localStorage.getItem(DEPARTMENTS_STORAGE_KEY);
            if (!data) {
                const defaultDepts = [
                    { id: 1, name: "Produ√ß√£o", active: true },
                    { id: 2, name: "Administrativo", active: true },
                    { id: 3, name: "RH", active: true },
                    { id: 4, name: "Financeiro", active: true },
                    { id: 5, name: "TI", active: true }
                ];
                localStorage.setItem(DEPARTMENTS_STORAGE_KEY, JSON.stringify(defaultDepts));
                return defaultDepts;
            }
            return JSON.parse(data);
        }
        
        function saveDepartments(departments) {
            localStorage.setItem(DEPARTMENTS_STORAGE_KEY, JSON.stringify(departments));
            
            if (currentUser && db) {
                db.collection('users').doc(currentUser.uid).update({
                    departments: departments,
                    lastSync: firebase.firestore.FieldValue.serverTimestamp()
                }).catch(err => console.error("Erro ao sincronizar:", err));
            }
        }
        
        function getCalculations() {
            const data = localStorage.getItem(CALCULATIONS_STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }
        
        function saveCalculations(calculations) {
            localStorage.setItem(CALCULATIONS_STORAGE_KEY, JSON.stringify(calculations));
            
            if (currentUser && db) {
                db.collection('users').doc(currentUser.uid).update({
                    calculations: calculations,
                    lastSync: firebase.firestore.FieldValue.serverTimestamp()
                }).catch(err => console.error("Erro ao sincronizar:", err));
            }
        }

        // ============================================
        // FUN√á√ïES DE C√ÅLCULO
        // ============================================
        
        function parseTime(timeStr) {
            if (!timeStr) return 0;
            const parts = timeStr.split(':');
            return parseInt(parts[0] || 0) + (parseInt(parts[1] || 0) / 60);
        }
        
        function formatCurrencyInput(input) {
            let value = input.value.replace(/\D/g, '');
            if (!value) {
                input.value = '';
                return;
            }
            
            while (value.length < 3) value = '0' + value;
            
            let integerPart = value.slice(0, -2).replace(/^0+/, '') || '0';
            let decimalPart = value.slice(-2);
            
            integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            input.value = integerPart + ',' + decimalPart;
        }
        
        function calcular() {
            const salarioInput = document.getElementById('salarioBase').value;
            const salario = parseFloat(salarioInput.replace(/\./g, '').replace(',', '.')) || 0;
            const divisor = parseFloat(document.getElementById('divisorMensal').value) || 220;
            const usaPericulosidade = document.getElementById('usaPericulosidade').checked;
            
            const horasSobreaviso = parseTime(document.getElementById('horasSobreavisoTotal').value);
            const horasTrabalhadas50 = parseTime(document.getElementById('horasTrabalhadas50').value);
            const horasTrabalhadas100 = parseTime(document.getElementById('horasTrabalhadas100').value);
            const horasNoturnas = parseTime(document.getElementById('horasNoturnas').value);
            
            const diasAtestado = parseFloat(document.getElementById('diasAtestado').value) || 0;
            const diasFeriado = parseFloat(document.getElementById('diasFeriado').value) || 0;
            const diasTrabalhados = Math.max(0, 30 - diasAtestado);
            
            document.getElementById('diasTrabalhados').value = diasTrabalhados;
            
            // C√°lculos b√°sicos
            const horaNormal = salario / divisor;
            const periculosidadeMensal = salario * 0.30;
            const periculosidadeProRata = usaPericulosidade ? (periculosidadeMensal / 30) * diasTrabalhados : 0;
            
            // Periculosidade por hora
            const periculosidadeHora = periculosidadeMensal / divisor;
            const baseHoraExtra = horaNormal + (usaPericulosidade ? periculosidadeHora : 0);
            
            // Adicionais
            const valorSobreaviso = horasSobreaviso * (horaNormal / 3);
            const valorExtra50 = horasTrabalhadas50 * (baseHoraExtra * 1.5);
            const valorExtra100 = horasTrabalhadas100 * (baseHoraExtra * 1.5);
            const valorNoturno = horasNoturnas * (horaNormal * 0.20);
            
            // DSR
            const diasUteis = 26 - diasFeriado;
            const fatorDSR = diasUteis > 0 ? (4 + diasFeriado) / diasUteis : 0;
            
            // Reflexos
            const reflexoSobreaviso = valorSobreaviso * fatorDSR;
            const reflexoExtra50 = valorExtra50 * fatorDSR;
            const reflexoExtra100 = valorExtra100 * fatorDSR;
            const reflexoNoturno = valorNoturno * fatorDSR;
            const totalReflexos = reflexoSobreaviso + reflexoExtra50 + reflexoExtra100 + reflexoNoturno;
            
            // Atualizar UI
            document.getElementById('valorPericulosidade').textContent = R$.format(periculosidadeProRata);
            document.getElementById('valorPericulosidadeInputDisplay').textContent = R$.format(periculosidadeProRata);
            document.getElementById('valorSobreavisoEspera').textContent = R$.format(valorSobreaviso);
            document.getElementById('valorHoraExtraTrabalho50').textContent = R$.format(valorExtra50);
            document.getElementById('valorHoraExtraTrabalho100').textContent = R$.format(valorExtra100);
            document.getElementById('valorAdicionalNoturno').textContent = R$.format(valorNoturno);
            
            document.getElementById('fatorDSRDisplay').textContent = fatorDSR.toFixed(4);
            document.getElementById('valorReflexoSobreavisoEspera').textContent = R$.format(reflexoSobreaviso);
            document.getElementById('valorReflexoSobreavisoTrabalhado').textContent = R$.format(reflexoExtra50);
            document.getElementById('valorReflexoHorasExtrasNormal').textContent = R$.format(reflexoExtra100);
            document.getElementById('valorReflexoAdicionalNoturno').textContent = R$.format(reflexoNoturno);
            document.getElementById('valorReflexoDSRTotalSum').textContent = R$.format(totalReflexos);
            
            document.getElementById('horaNormal').textContent = R$.format(horaNormal);
            document.getElementById('horaSobreaviso').textContent = R$.format(horaNormal / 3);
            document.getElementById('baseHePeric').textContent = R$.format(baseHoraExtra) + (usaPericulosidade ? " (c/ Peric.)" : " (s/ Peric.)");
            document.getElementById('horaExtra50').textContent = R$.format(baseHoraExtra * 1.5);
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ Aplica√ß√£o iniciando...");
            
            // Configurar data atual
            const hoje = new Date();
            const mesAtual = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}`;
            document.getElementById('mesReferencia').value = mesAtual;
            
            // Event listeners
            document.getElementById('salarioBase').addEventListener('input', function() {
                formatCurrencyInput(this);
                calcular();
            });
            
            document.getElementById('diasAtestado').addEventListener('input', calcular);
            document.getElementById('diasFeriado').addEventListener('input', calcular);
            document.getElementById('divisorMensal').addEventListener('change', calcular);
            document.getElementById('usaPericulosidade').addEventListener('change', calcular);
            
            document.getElementById('horasSobreavisoTotal').addEventListener('input', calcular);
            document.getElementById('horasTrabalhadas50').addEventListener('input', calcular);
            document.getElementById('horasTrabalhadas100').addEventListener('input', calcular);
            document.getElementById('horasNoturnas').addEventListener('input', calcular);
            
            document.getElementById('clearButton').addEventListener('click', function() {
                document.getElementById('salarioBase').value = '';
                document.getElementById('horasSobreavisoTotal').value = '00:00';
                document.getElementById('horasTrabalhadas50').value = '00:00';
                document.getElementById('horasTrabalhadas100').value = '00:00';
                document.getElementById('horasNoturnas').value = '00:00';
                document.getElementById('diasAtestado').value = '0';
                document.getElementById('diasFeriado').value = '0';
                document.getElementById('divisorMensal').value = '220';
                document.getElementById('usaPericulosidade').checked = true;
                calcular();
            });
            
            // Tabs do menu
            document.getElementById('menuCalculator').addEventListener('click', function() {
                document.getElementById('calculatorContent').classList.remove('hidden');
                document.getElementById('collaboratorsContent').classList.add('hidden');
            });
            
            document.getElementById('menuCollaborators').addEventListener('click', function() {
                document.getElementById('calculatorContent').classList.add('hidden');
                document.getElementById('collaboratorsContent').classList.remove('hidden');
                renderCollaboratorsTable('active');
            });
            
            // Bot√µes de colaboradores
            document.getElementById('addNewCollaborator').addEventListener('click', function() {
                alert('Funcionalidade em desenvolvimento. Use Importar Planilha!');
            });
            
            document.getElementById('importCollaboratorsBtn').addEventListener('click', function() {
                document.getElementById('importSpreadsheetModal').classList.add('active');
            });
            
            document.getElementById('closeImportModal').addEventListener('click', function() {
                document.getElementById('importSpreadsheetModal').classList.remove('active');
            });
            
            document.getElementById('cancelImport').addEventListener('click', function() {
                document.getElementById('importSpreadsheetModal').classList.remove('active');
            });
            
            // Status buttons
            document.getElementById('showActiveCollaborators').addEventListener('click', function() {
                renderCollaboratorsTable('active');
                this.classList.add('active');
                document.getElementById('showInactiveCollaborators').classList.remove('active');
            });
            
            document.getElementById('showInactiveCollaborators').addEventListener('click', function() {
                renderCollaboratorsTable('inactive');
                this.classList.add('active');
                document.getElementById('showActiveCollaborators').classList.remove('active');
            });
            
            // File upload
            const fileInput = document.getElementById('spreadsheetFile');
            const fileArea = document.getElementById('fileUploadArea');
            
            fileArea.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', function(e) {
                if (this.files.length) {
                    alert(`Arquivo selecionado: ${this.files[0].name}\nFuncionalidade completa em desenvolvimento!`);
                }
            });
            
            // Calcular ao iniciar
            calcular();
            
            // Verificar se j√° deve pular login
            if (localStorage.getItem('skipLogin')) {
                document.getElementById('loginModal').style.display = 'none';
                updateFirebaseStatus('offline', 'Modo offline');
            }
        });

        // ============================================
        // FUN√á√ÉO PARA RENDERIZAR TABELA DE COLABORADORES
        // ============================================
        
        function renderCollaboratorsTable(status = 'active') {
            const collaborators = getCollaborators();
            const container = document.getElementById('collaboratorsTableContainer');
            
            const filtered = status === 'active' 
                ? collaborators.filter(c => c.active !== false)
                : collaborators.filter(c => c.active === false);
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 bg-white rounded-lg border">
                        <i class="fas fa-users text-gray-400 text-5xl mb-4"></i>
                        <p class="text-gray-500 text-lg">Nenhum colaborador ${status === 'active' ? 'ativo' : 'inativo'}</p>
                        <p class="text-gray-400 text-sm mt-2">Clique em "Importar Planilha" para adicionar</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="bg-white rounded-lg border overflow-hidden">
                    <table class="collaborator-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Departamento</th>
                                <th>Sal√°rio</th>
                                <th>Periculosidade</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filtered.forEach(c => {
                html += `
                    <tr>
                        <td class="font-medium">${c.name || 'Sem nome'}</td>
                        <td>${c.department || 'N√£o especificado'}</td>
                        <td class="moeda-br">R$ ${c.baseSalary || '0,00'}</td>
                        <td>
                            <span class="px-2 py-1 rounded text-xs ${c.periculosidade ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'}">
                                ${c.periculosidade ? 'Sim' : 'N√£o'}
                            </span>
                        </td>
                        <td>
                            <button class="text-red-600 hover:text-red-800 text-sm" onclick="alert('Funcionalidade em desenvolvimento')">
                                <i class="fas fa-trash mr-1"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }

        console.log("‚úÖ C√≥digo carregado com sucesso!");
    </script>
</body>
</html>
